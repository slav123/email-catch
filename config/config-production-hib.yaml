server:
  ports: [25, 587, 465, 2525]
  hostname: "capture.hib.pl"
  tls:
    enabled: true
    # These files will be auto-generated by Let's Encrypt
    cert_file: "certs/letsencrypt/capture.hib.pl.crt"
    key_file: "certs/letsencrypt/capture.hib.pl.key"
    letsencrypt:
      enabled: true
      domains: ["capture.hib.pl"]
      email: "admin@hib.pl"  # Update this to your actual email
      cache_dir: "certs/letsencrypt"
      staging: false  # Set to true first for testing, then false for production
      http_port: 80   # Port for HTTP-01 challenge
      renew_before_days: 30
  rate_limit:
    enabled: true
    max_emails_per_minute: 1000
    max_email_size_mb: 50

storage:
  s3_compatible:
    enabled: true
    # Cloudflare R2 endpoint
    endpoint: "https://98bc492cc3a27daf762bb12c3bd97ca9.r2.cloudflarestorage.com"
    access_key: "98bc492cc3a27daf762bb12c3bd97ca9"
    secret_key: "3af89786ae194079aa34460f18b2144f25b0ff239c2ff978e0247511a284e423"
    bucket: "email"
    region: "auto"  # Cloudflare R2 uses "auto" region
    use_ssl: true
    path_prefix: "emails"
  local:
    enabled: true
    directory: "/opt/email-catch/emails"

routes:
  # Catch all emails to any @hib.pl domain
  - name: "hib_domain_capture"
    condition:
      recipient_pattern: ".*@hib\\.pl"
    actions:
      - type: "store_s3"
        enabled: true
        config:
          folder: "hib-domain"
      - type: "store_local"
        enabled: true
        config:
          folder: "hib-backup"
    enabled: true

  # Capture emails to capture.hib.pl subdomain
  - name: "capture_subdomain"
    condition:
      recipient_pattern: ".*@capture\\.hib\\.pl"
    actions:
      - type: "store_s3"
        enabled: true
        config:
          folder: "capture"
      - type: "store_local"
        enabled: true
        config:
          folder: "capture-backup"
    enabled: true

  # Support and admin emails
  - name: "support_emails"
    condition:
      recipient_pattern: "(support|admin|postmaster)@.*"
    actions:
      - type: "store_s3"
        enabled: true
        config:
          folder: "support"
      - type: "store_local"
        enabled: true
        config:
          folder: "support-backup"
    enabled: true

  # Test emails
  - name: "test_emails"
    condition:
      recipient_pattern: "test@.*"
    actions:
      - type: "store_s3"
        enabled: true
        config:
          folder: "testing"
      - type: "store_local"
        enabled: true
        config:
          folder: "test-backup"
    enabled: true

  # Catch-all for any other emails
  - name: "catch_all"
    condition:
      recipient_pattern: ".*"
    actions:
      - type: "store_s3"
        enabled: true
        config:
          folder: "general"
      - type: "store_local"
        enabled: true
        config:
          folder: "general-backup"
    enabled: true

logging:
  level: "info"
  format: "json"
  file: "/opt/email-catch/logs/email-catch.log"